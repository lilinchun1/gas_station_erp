<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>监控平台</title>
    <link rel="stylesheet" href="__PUBLIC__/css/configuration.css"/>
    <script type="text/javascript" src="__PUBLIC__/js/jquery-1.10.2.min.js"></script>
	<script type="text/javascript" src="__PUBLIC__/js/jquery.SuperSlide.2.1.1.js"></script>
	<script type="text/javascript" src="__PUBLIC__/js/My97DatePicker/WdatePicker.js"></script>
    <style>
        #head,.head-wrap,#footer,#container{
            min-width: 1300px;
        }
    </style>
</head>
<body>
<include file="./Tpl/include/pb-head.html" />
<div id="container">
    <div class="left">
        <include file="./Tpl/include/pb-monitoring-aside.html" />
    </div>
    <div class="right">
        <div class="right-con">
            <div class="station-con" id="j-tataion-tool">
                <div class="station-control">
                    <ul class="station-control-list">
                        <li>
                            <h4>系统监控</h4>
                            <span><img src="__PUBLIC__/image/6.png" alt=""/></span>
                            <dl class="station-zhuangtai">
                                <dt><b class="icon-checkmark-circle green-color"></b><em>{$devRightNum}</em></dt>
                                <dt><b class="icon-cancel-circle red-color"></b><em>{$devBreakNum}</em></dt>
                            </dl>
                        </li>
                        <li>
                            <h4>APP应用</h4>
                            <span><img src="__PUBLIC__/image/1.png" alt=""/></span>
                            <dl class="station-zhuangtai">
                                <dt><b class="icon-checkmark-circle green-color"></b><em>10000</em></dt>
                                <dt><b class="icon-cancel-circle red-color"></b><em>20</em></dt>
                            </dl>
                        </li>
                        <li>
                            <h4>媒体广告</h4>
                            <span><img src="__PUBLIC__/image/4.png" alt=""/></span>
                            <dl class="station-zhuangtai">
                                <dt><b class="icon-checkmark-circle green-color"></b><em>10000</em></dt>
                                <dt><b class="icon-cancel-circle red-color"></b><em>20</em></dt>
                            </dl>
                        </li>
                        <li>
                            <h4>远程操作</h4>
                            <span><img src="__PUBLIC__/image/5.png" alt=""/></span>
                            <dl class="station-zhuangtai">
                                <dt><b class="icon-checkmark-circle green-color"></b><em>10000</em></dt>
                                <dt><b class="icon-cancel-circle red-color"></b><em>20</em></dt>
                            </dl>
                        </li>
                    </ul>
                    <div class="station-state-list-cx">
                        <label for="channel-ss-are">所属网点</label>
                        <select name="add_agent_type_sel" id="channel-ss-are" class="channel-select-min">
                            <option selected value="">省份</option>
                            <option class="industry" value="trade">2</option>
                            <option class="area" value="area">3</option>
                        </select>
                        <select name="add_agent_type_sel" id="channel-class2" class="channel-select-min">
                            <option selected value="">城市</option>
                            <option class="industry" value="trade">2</option>
                            <option class="area" value="area">3</option>
                        </select>
                       <!-- <select name="add_agent_type_sel" id="channel-class3" class="channel-select-min">
                            <option selected value="">区域</option>
                            <option class="industry" value="trade">2</option>
                            <option class="area" value="area">3</option>
                        </select>-->
                        <input placeholder="请输入渠道名称" type="text" name="" id="channel-ss-channel" class="station-info"/>
                        <button type="button" class="role-control-btn">查询</button>
                        <button type="button" class="role-control-btn">导出</button>
                        <div class="mode-change">
                            <a href="" class="active">监控台模式</a> <a href="">列表模式</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="station-state-list"  id="j-station-sh1">
                <div class="station-state-tree1">
					<div class="zTreeDemoBackground left">
							<ul id="treeDemo" class="ztree"></ul>
					</div>
                </div>
                <ul class="station-state-list-con">
                    <foreach name="devPageBreakArr" item="devBreak">
	                    <li>
	                        <div class="station-state-info">
	                            <!-- <em>报警时间 ：  2014-05-11   12：20</em>
	                            <em>报警时长  ： 6小时20分</em> -->
	                            <em>{$devBreak['province']}  {$devBreak['city']}  {$devBreak['address']}</em>
	                        </div>
	                        <div class="station-state-dl">
	                            <div class="row-lt">
	                                <span class="row-lt-l">
	                                    <em>在线状态</em>
	                                    <if condition="$devBreak['on_line'] eq 0">
											<span class="icon-checkmark green-color"></span>
										<else />
											<span class="icon-close red-color"></span>
										</if>
	                                </span>
	                                <span class="row-lt-l">
	                                    <em>正常开机</em>
	                                    <if condition="$devBreak['start_time'] eq 0">
											<span class="icon-checkmark green-color"></span>
										<else />
											<span class="icon-close red-color"></span>
										</if>
	                                </span>
	                                <span class="row-lt-l">
	                                    <em>正常关机</em>
	                                    <if condition="$devBreak['shutdown_time'] eq 0">
											<span class="icon-checkmark green-color"></span>
										<else />
											<span class="icon-close red-color"></span>
										</if>
	                                </span>
	                            </div>
	                            <div class="row-lt">
	                                <span class="row-lt-l">
	                                    <em>APP刊例</em>
	                                    <span class="icon-close red-color"></span>
	                                </span>
	                                <span class="row-lt-l">
	                                    <em>上屏程序版本</em>
	                                    <span class="icon-checkmark green-color"></span>
	                                </span>
	                                <span class="row-lt-l">
	                                    <em>下屏程序版本</em>
	                                    <span class="icon-close red-color"></span>
	                                </span>
	                            </div>
	                            <div class="row-lt">
	                                <span class="row-lt-l">
	                                    <em class="ccc-color">中屏状态</em>
	                                    <span class="icon-spam yellow-color"></span>
	                                </span>
	                                <span class="row-lt-l">
	                                    <em class="ccc-color">上屏状态</em>
	                                    <span class="icon-spam yellow-color"></span>
	                                </span>
	                                <span class="row-lt-l">
	                                    <em class="ccc-color">广告刊例</em>
	                                    <span class="icon-spam yellow-color"></span>
	                                </span>
	                            </div>
	                            <div class="row-lt">
	                                <span class="row-lt-l">
	                                    <em class="ccc-color">网络流量预警</em>
	                                    <span class="icon-spam yellow-color"></span>
	                                </span>
	                                <span class="row-lt-l">
	                                    <em class="ccc-color">开关机时间预警</em>
	                                    <span class="icon-spam yellow-color"></span>
	                                </span>
	                            </div>
	                            <div class="row-lt">
	                                <span class="row-lt-l">
	                                    <em class="ccc-color">CPU预警</em>
	                                    <span class="icon-spam yellow-color"></span>
	                                </span>
	                                <span class="row-lt-l">
	                                    <em class="ccc-color">硬盘预警</em>
	                                    <span class="icon-spam yellow-color"></span>
	                                </span>
	                            </div>
	                        </div>
	                    </li>
                    </foreach>
                </ul>
            </div>
            <div class="station-state-list table-state" id="j-station-sh2">
                <ul class="station-list2-wz">
                    <li class="first-line">
                        <span>加油站所属网点</span>
                        <span>MAC地址</span>
                        <span>在线状态</span>
                        <span>正常开机</span>
                        <span>正常关机</span>
                        <span>APP刊例</span>
                        <span>上屏程序版本</span>
                        <span>下屏程序版本</span>
                    </li>
                    <li>
                        <span title="#">11111111111111111111Lorem ipsum dolor sit amet.</span>
                        <span title="#">Lorem ipsum dolor sit amet.</span>
                        <span title="#">Facere impedit qui tenetur voluptates!</span>
                        <span title="#">A dicta dolorem quo similique.</span>
                        <span title="#">Ipsam molestias nesciunt ratione sapiente.</span>
                        <span title="#">Maxime natus nulla pariatur tempore?</span>
                        <span title="#">Inventore officia optio perferendis quis.</span>
                        <span title="#">Laboriosam magnam necessitatibus similique ut.</span>
                    </li>
                    <li>
                        <span title="#">11111111111111111111Lorem ipsum dolor sit amet.</span>
                        <span title="#">Lorem ipsum dolor sit amet.</span>
                        <span title="#">Facere impedit qui tenetur voluptates!</span>
                        <span title="#">A dicta dolorem quo similique.</span>
                        <span title="#">Ipsam molestias nesciunt ratione sapiente.</span>
                        <span title="#">Maxime natus nulla pariatur tempore?</span>
                        <span title="#">Inventore officia optio perferendis quis.</span>
                        <span title="#">Laboriosam magnam necessitatibus similique ut.</span>
                    </li>
                    <li>
                        <span title="#">11111111111111111111Lorem ipsum dolor sit amet.</span>
                        <span title="#">Lorem ipsum dolor sit amet.</span>
                        <span title="#">Facere impedit qui tenetur voluptates!</span>
                        <span title="#">A dicta dolorem quo similique.</span>
                        <span title="#">Ipsam molestias nesciunt ratione sapiente.</span>
                        <span title="#">Maxime natus nulla pariatur tempore?</span>
                        <span title="#">Inventore officia optio perferendis quis.</span>
                        <span title="#">Laboriosam magnam necessitatibus similique ut.</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
<include file="./Tpl/include/pb-foot.html" />
<script type="text/javascript" src="__PUBLIC__/js/jquery-1.6.1.js"></script>
<!--树形结构类-->
<link rel="stylesheet" href="__PUBLIC__/css/tree/tree.css" type="text/css">
<script type="text/javascript" src="__PUBLIC__/js/tree/jquery.ztree.core-3.5.js"></script>
<script type="text/javascript" src="__PUBLIC__/js/tree/jquery.ztree.excheck-3.5.js"></script>
<script type="text/javascript" src="__PUBLIC__/js/jquery.SuperSlide.2.1.1.js"></script>
<script type="text/javascript">jQuery(".alert-set-tab").slide({trigger:"click"});</script>
<script>
//===================================================树形结构js==========================
var setting = {
    data: {
        key: {
            title: "t"
        },
        simpleData: {
            enable: true
        }
    },
    view: {
        fontCss: getFontCss
    }
};
var handleUrl="{:U('monitoring/Index/getProvinceCity')}";
var zNodes=new Array();
var now=new Date().getTime();//加个时间戳表示每次是新的请求
$.ajax({
    type: "POST",
    url: handleUrl,
    async: false,
    dataType: "json",
    success: function(data){
        $.each(data,function(key,val){
            var kid=val['id'];
            var parent=val['parent'];
            var value=val['value'];
            zNodes[key]= {'id':kid, 'pId':parent, 'name':value, 'open':true ,'t':kid};
        });
    },

    error: function(XMLHttpRequest, textStatus, errorThrown) {
        // alert("请求失败!");
    }
});

function focusKey(e) {
    if (key.hasClass("empty")) {
        key.removeClass("empty");
    }
}
function blurKey(e) {
    if (key.get(0).value === "") {
        key.addClass("empty");
    }
}
var lastValue = "", nodeList = [], fontCss = {};
function clickRadio(e) {
    lastValue = "";
    searchNode(e);
}
function searchNode(e) {
    var zTree = $.fn.zTree.getZTreeObj("treeDemo");
    if (!$("#getNodesByFilter").attr("checked")) {
        var value = $.trim(key.get(0).value);
        var keyType = "";
        if ($("#name").attr("checked")) {
            keyType = "name";
        } else if ($("#level").attr("checked")) {
            keyType = "level";
            value = parseInt(value);
        } else if ($("#id").attr("checked")) {
            keyType = "id";
            value = parseInt(value);
        }
        if (key.hasClass("empty")) {
            value = "";
        }
        if (lastValue === value) return;
        lastValue = value;
        if (value === "") return;
        updateNodes(false);

        if ($("#getNodeByParam").attr("checked")) {
            var node = zTree.getNodeByParam(keyType, value);
            if (node === null) {
                nodeList = [];
            } else {
                nodeList = [node];
            }
        } else if ($("#getNodesByParam").attr("checked")) {
            nodeList = zTree.getNodesByParam(keyType, value);
        } else if ($("#getNodesByParamFuzzy").attr("checked")) {
            nodeList = zTree.getNodesByParamFuzzy(keyType, value);
        }
    } else {
        updateNodes(false);
        nodeList = zTree.getNodesByFilter(filter);
    }
    updateNodes(true);

}
function updateNodes(highlight) {
    var zTree = $.fn.zTree.getZTreeObj("treeDemo");
    for( var i=0, l=nodeList.length; i<l; i++) {
        nodeList[i].highlight = highlight;
        zTree.updateNode(nodeList[i]);
    }
}
function getFontCss(treeId, treeNode) {
    return (!!treeNode.highlight) ? {color:"#A60000", "font-weight":"bold"} : {color:"#333", "font-weight":"normal"};
}
function filter(node) {
    return !node.isParent && node.isFirstNode;
}

var key;

//===================================================树形结构js结束==========
    $(function () {
		//===================================================树形结构js传递==========
		$.fn.zTree.init($("#treeDemo"), setting, zNodes);
		key = $("#key");
		key.bind("focus", focusKey)
				.bind("blur", blurKey)
				.bind("propertychange", searchNode)
				.bind("input", searchNode);
		$("#name").bind("change", clickRadio);
		$("#level").bind("change", clickRadio);
		$("#id").bind("change", clickRadio);
		$("#getNodeByParam").bind("change", clickRadio);
		$("#getNodesByParam").bind("change", clickRadio);
		$("#getNodesByParamFuzzy").bind("change", clickRadio);
		$("#getNodesByFilter").bind("change", clickRadio);
        $('.mode-change a:eq(0)').click(function () {
            $('#j-station-sh1').show();
            $('#j-station-sh2').hide();
            $(this).addClass('active');
            $('.mode-change a:eq(1)').removeClass();
            return false;
        });
        $('.mode-change a:eq(1)').click(function () {
            $('#j-station-sh1').hide();
            $('#j-station-sh2').show();
            $(this).addClass('active');
            $('.mode-change a:eq(0)').removeClass();
            return false;
        });
        
        //循环刷新
        var iID=setTimeout(function(){
			location.reload();
        },1000*60*60);
        
    });

</script>
</body>
</html>