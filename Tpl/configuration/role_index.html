<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>角色维护</title>
    <!--<link rel="stylesheet" href="../../Public/css/configuration.css"/>-->
	<link rel="stylesheet" href="__PUBLIC__/css/configuration.css"/>
</head>
<body>
<include file="./Tpl/include/pb-head.html" />
<div id="container">
    <div class="left">
        <ul class="aside-nav">
            <li class="aside-nav-nth1"><a href="{:U('configuration/Org/index')}">系统设置</a></li>
            <li><a href="{:U('configuration/Org/index')}"><input  type="button"  value="组织结构" ></a></li>
            <li class="active"><a href="{:U('configuration/Role/index')}"><input type="button" class="" value="角色维护" ></a></li>
            <li><a href="{:U('configuration/User/index')}"><input type="button" class="" value="职员维护" ></a></li>
        </ul>
    </div>
    <div class="right">
        <div class="right-con">
            <div class="org-right-con">
                <div class="role-control" id="j-fixed-top">
                    <div class="role-inquire">
                        <form name="roleSelect" method="get" action="{:U('configuration/Role/show_role')}">
                            <label for="role-name" class="role-lab">角色名称</label>
                            <input type="text" name="role_name_txt" id="role_name_txt" class="input-org-info"/>
                            <input type="submit" id="select_button" name="select_button" class="role-control-btn">
                        </form>
                    </div>
                    <div class="org-right-btns">
                        <form action="">
                            <button type="button" class="area-btn" id="j_add_button">添加</button>
                            <button type="button" class="area-btn">编辑</button>
                            <button type="button" class="area-btn">删除</button>
                            <button type="button" class="area-btn">查看权限</button>
                        </form>
                    </div>
                </div>
                <div class="role-table over-h-y">
                    <ul class="role-table-list">
                        <li>
                            <span class="span-1"></span>
                            <span class="span-2"><b>角色名称</b></span>
                            <span class="span-3"><b>角色描述</b></span>
                            <span class="span-2"><b>创建人</b></span>
                            <span class="span-2"><b>创建日期</b></span>
                        </li>
						<volist name="list" id="vo">
							<li>
								<span class="span-1"><input type="radio" name="role-info" id="" class="role-table-radio"/></span>
								<span class="span-2" title="#">{$vo.rolename}</span>
								<span class="span-3" title="#">{$vo.memo}</span>
								<span class="span-2" title="#">{$vo.addusername}</span>
								<span class="span-2" title="#">{$vo.adddate}</span>
							</li>
						</volist>
                    </ul>
					<div class="resultpage">{$page}</div>
                </div>
            </div>
        </div>
    </div>
</div>

<include file="./Tpl/include/pb-foot.html" />

<div id="j_add_win" style="display:none;">
	<div class="alert-role-add">
		<h3>添加角色信息</h3>
		<div class="alert-role-add-con">
			<form action="">
				<p>
					<label for="role-addname" class="role-lab">角色名称</label>
					<input type="text" name="addname" id="role-addname" class="input-role-name"/>
				</p>
				<p>
					<label for="role-textarea" class="role-lab">角色名称</label>
					<textarea name="" id="role-textarea" cols="30" rows="3" class="role-teatarea"></textarea>
				</p>
				<p>
					<label for="">设置权限</label>
					<input type="button" value="权限设置"/>
					<!--权限树形-->
					<div class="zTreeDemoBackground left">
							<ul id="treeDemo" class="ztree"></ul>
					</div>

				</p>
				<p>
					<button type="button" class="alert-btn2">保存</button>
					<button type="button" class="alert-btn2">关闭</button>
				</p>
			</form>
		</div>
	</div>
</div>
<div class="alert-role-add">
    <h3>编辑角色信息</h3>
    <div class="alert-role-add-con">
        <form action="">
            <p>
                <label for="role-addname" class="role-lab">角色名称</label>
                <input type="text" name="addname" id="role-addname" class="input-role-name"/>
            </p>
            <p>
                <label for="role-textarea" class="role-lab">角色名称</label>
                <textarea name="" id="role-textarea" cols="30" rows="3" class="role-teatarea"></textarea>
            </p>
            <p>
                <label for="">设置权限</label>
                <!-- 容器 -->
            <div id="J_Tree"></div>
            <!-- 结果收集、设置回显数据 -->
            <input type="hidden" id="J_TreeResult" value='{"id":"291"}'>
            </p>
            <p>
                <button type="button" class="alert-btn2">保存</button>
                <button type="button" class="alert-btn2">关闭</button>
            </p>
        </form>
    </div>
</div>
<div class="alert-role-add">
    <h3>角色信息</h3>
    <div class="alert-role-add-con">
        <p class="delete-message">请确认是否删除？</p>
        <p>
            <button type="button" class="alert-btn2">删除</button>
            <button type="button" class="alert-btn2">关闭</button>
        </p>
    </div>
</div>
</body>
<script type="text/javascript" src="__PUBLIC__/js/jquery-1.6.1.js"></script>
<script type="text/javascript" src="__PUBLIC__/js/jquery.DOMwindow.js" type="text/javascript"></script><!--模框JS插件-->
<!--树形结构类-->
<link rel="stylesheet" href="__PUBLIC__/css/tree/tree.css" type="text/css">
<script type="text/javascript" src="__PUBLIC__/js/tree/jquery.ztree.core-3.5.js"></script>
<script type="text/javascript" src="__PUBLIC__/js/tree/jquery.ztree.excheck-3.5.js"></script>
<script>
    window.onscroll=function(){
        var scrollTop=document.documentElement.scrollTop||document.body.scrollTop;
        var fixDiv=document.getElementById('j-fixed-top');
        if(scrollTop>=300){
            fixDiv.style.position='fixed';
            fixDiv.style.top='0px';
        }else if(scrollTop<=299){
            fixDiv.style.position='static';
        }
    }
//===================================================树形结构js==========================
var setting = {
	check: {
		enable: true
	},
	data: {
		simpleData: {
			enable: true
		}
	}
};
var handleUrl="{:U('configuration/Role/select_all_purview')}";
var zNodes=new Array();
var now=new Date().getTime();//加个时间戳表示每次是新的请求
$.ajax({
    type: "POST",
    url: handleUrl,
    async: false,
    dataType: "json",
    success: function(data){
        $.each(data,function(key,val){
            var kid=val['id'];
            var parent=val['parent'];
            var value=val['value'];
            zNodes[key]= {'id':kid, 'pId':parent, 'name':value, 'open':true ,'t':kid};
        });
    },

    error: function(XMLHttpRequest, textStatus, errorThrown) {
        // alert("请求失败!");
    }
});

		var code;
		
		function setCheck() {
			var zTree = $.fn.zTree.getZTreeObj("treeDemo"),
			py = $("#py").attr("checked")? "p":"",
			sy = $("#sy").attr("checked")? "s":"",
			pn = $("#pn").attr("checked")? "p":"",
			sn = $("#sn").attr("checked")? "s":"",
			type = { "Y":py + sy, "N":pn + sn};
			zTree.setting.check.chkboxType = type;
			showCode('setting.check.chkboxType = { "Y" : "' + type.Y + '", "N" : "' + type.N + '" };');
		}
		function showCode(str) {
			if (!code) code = $("#code");
			code.empty();
			code.append("<li>"+str+"</li>");
		}
		

//===================================================树形结构js结束==========




$(document).ready(function(){

//===================================================树形结构js传递==========
			$.fn.zTree.init($("#treeDemo"), setting, zNodes);
			setCheck();
			$("#py").bind("change", setCheck);
			$("#sy").bind("change", setCheck);
			$("#pn").bind("change", setCheck);
			$("#sn").bind("change", setCheck);



	$('#j_add_button').click(function(){
        //保存
        $('#j_add_save').click(function(){
            var add_agent_name_txt=$('#j_add_org').val();//组织机构名称

            var add_agent_type_sel=$("#add_agent_type_sel").val();//代理商类型

            var add_agent_level_sel=$('#add_agent_level_sel').val();//代理商级别

            var add_legal_txt=$('#j_add_linkman').val();//联系人

            var add_companyAddr_txt=$('#j_add_address').val();//办公地址

            var add_tel_txt=$('#add_tel_txt').val();//公司电话

            var add_contract_number_txt=$('#j_add_contract-number').val();//合同编号

            var add_father_agentid_sel=$('#j_add_org-s').val();//上级组织机构

            var add_legal_tel_txt=$('#j_add_phone').val();//联系电话

            var add_org_area=$('#resvals').val();//业务范围

            var add_begin_time_sel=$('#j_add_sq-date').val();//授权日期

            var add_end_time_sel=$('#j_add_date').val();//授权日期

            var is_add_forever_checked = $("#j_add_forever_check").attr('checked');
            var add_forever_check="";
            if('checked' == is_add_forever_checked)
            {
                var add_forever_check = '1';
            }
            else
            {
                var add_forever_check = '0';
            }

            //return false;
            var add_handleUrl="{:U('configuration/Org/add_org')}";
            $.getJSON(add_handleUrl,{"add_agent_name_txt":add_agent_name_txt,"add_legal_txt":add_legal_txt,
                        "add_agent_level_sel":add_agent_level_sel,
                        "add_agent_type_sel":add_agent_type_sel,
                        "add_companyAddr_txt":add_companyAddr_txt,
                        "add_tel_txt":add_tel_txt,

                        "add_contract_number_txt":add_contract_number_txt,"add_father_agentid_sel":add_father_agentid_sel,
                        "add_legal_tel_txt":add_legal_tel_txt,"add_org_area":add_org_area,"add_contract_number_txt":add_contract_number_txt,
                        "add_companyAddr_txt":add_companyAddr_txt,"add_begin_time_sel":add_begin_time_sel,"add_end_time_sel":add_end_time_sel,"add_forever_check":add_forever_check},
                    function (data){
                        var tmp_msg = "{:C('add_agents_success')}";
                        if(tmp_msg == data)
                        {
                            alert(data);
                            window.location.href = window.location.href;
                        }
                        else
                        {
                            alert(data);
                            //$(".cli_tishi").html("<img src='__PUBLIC__/image/th.png'/>"+data+"");
                        }
                    }
                    ,'json'
            );
        });//结束
        $.openDOMWindow({
            loader:1,
            loaderHeight:16,
            loaderWidth:17,
            windowSourceID:'#j_add_win'
        });
        return false;
    });

	//=====================================================业务范围事件============================================
    $("#j-choose").click(function(){
        $.openLayer({
            maxItems : 5,
            pid : "0",
            returnText : "restxts",
            returnValue : "resvals",
            span_width : {d1:120,d2:150,d3:150},
            index : 10005
        });
    });
});
</script>
</html>